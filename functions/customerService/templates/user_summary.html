<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kabir – User Summary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>

<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">User Summary</h1>

    <form method="POST" class="mb-4">
      <div class="mb-3">
        <label for="identifier" class="form-label">Phone or Email</label>
        <input
          type="text"
          id="identifier"
          name="identifier"
          class="form-control"
          placeholder="+919852824875 or user@email.com"
          value="{{ identifier or '' }}"
        />
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if summary %}
      <div class="card mb-4">
        <div class="card-header">User Details</div>
        <div class="card-body">
          <p><strong>User ID:</strong> {{ summary.userId }}</p>
          <p><strong>First Name:</strong> {{ summary.user.firstName }}</p>
          <p><strong>Last Name:</strong> {{ summary.user.lastName }}</p>
          <p><strong>Phone:</strong> {{ summary.user.phoneNumber }}</p>
          <p><strong>Email:</strong> {{ summary.user.email or '—' }}</p>
        </div>
      </div>

      {% if summary.latest_location %}
        <div class="card mb-4">
          <div class="card-header">Latest Location</div>
          <div class="card-body">
            <p><strong>Location:</strong> {{ summary.latest_location.location }}</p>
            <p><strong>LatLong:</strong> {{ summary.latest_location.latitude }} {{ summary.latest_location.longitude }}</p>
            <p><strong>Recorded At:</strong>
              {{ summary.latest_location.created_at_readable
                 or summary.latest_location.createdAt_readable
                 or summary.latest_location_createdAt_readable
                 or summary.latest_location.created_at
                 or summary.latest_location.createdAt
                 or '—' }}
            </p>
          </div>
        </div>
      {% else %}
        <div class="alert alert-secondary">No location data found.</div>
      {% endif %}

      <div class="card mb-4">
        <div class="card-header">Chat Summary</div>
        <div class="card-body">
          <p><strong>Chat Count:</strong> {{ summary.chat_count }}</p>
          <p><strong>Latest Chat Created At:</strong>
            {{ summary.latest_chat_createdAt_readable or summary.latest_chat_createdAt or '—' }}
          </p>
          <p><strong>Latest Chat Updated At:</strong>
            {{ summary.latest_chat_updatedAt_readable or summary.latest_chat_updatedAt or '—' }}
          </p>
        </div>
      </div>
    {% endif %}
  </div>
</body>
</html>
